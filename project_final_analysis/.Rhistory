# Load all libraries
library(tidyverse)
library(knitr)
library(patchwork)
library(kableExtra)
library(here)
library(logitr)
library(fastDummies)
library(maddTools)
# Base model
load(here("models","model.RData"))
# View summary of results
summary(model)
coefs <- coef(model)
coefs
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
head(scenarios)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
head(model)
head(scenarios)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
head(scenarios)
head(model)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
##### SUBGROUP ANALYSIS
load(here("models","model_ethnicity.RData"))
summary(model_ethnicity)
coefs_ethnicity <- coef(model_ethnicity)
covariance_ethnicity <- vcov(model_ethnicity)
coef_draws <- as.data.frame(MASS::mvrnorm(10^4, coefs_ethnicity, covariance))
coef_draws
##### SUBGROUP ANALYSIS
load(here("models","model_ethnicity.RData"))
summary(model_ethnicity)
coefs_ethnicity <- coef(model_ethnicity)
covariance_ethnicity <- vcov(model_ethnicity)
coef_draws <- as.data.frame(MASS::mvrnorm(10^4, coefs_ethnicity, covariance_ethnicity))
coef_draws
coef_draws_asian <- coef_draws %>%
mutate(
value = value + value_asian,
penalty = penalty + penalty_asian,
acessibility_1 = accessibility_1+accessibility_1_asian,
acessibility_3 = accessibility_3+accessibility_3_asian,
acessibility_10 = accessibility_10+accessibility_10_asian,
incentive_grocery_store = incentive_grocery_store + incentive_grocery_store_asian,
incentive_internet = incentive_internet + incentive_internet_asian,
incentive_sport_tickets = incentive_sport_tickets + incentive_sport_tickets_asian,
outsideGood = outsideGood + outsideGood_asian
) %>% select(value,penalty,acessibility_1,acessibility_3,acessibility_10,incentive_grocery_store,incentive_internet,incentive_sport_tickets,outsideGood)
scenarios
sim_asian <- maddTools::logitProbs(
coefs = coef_draws_asian,
newdata = scenarios,
obsID = 'obsID',
ci = 0.95
)
coef_draws_asian <- coef_draws %>%
mutate(
value = value + value_asian,
penalty = penalty + penalty_asian,
accessibility_1 = accessibility_1+accessibility_1_asian,
accessibility_3 = accessibility_3+accessibility_3_asian,
accessibility_10 = accessibility_10+accessibility_10_asian,
incentive_grocery_store = incentive_grocery_store + incentive_grocery_store_asian,
incentive_internet = incentive_internet + incentive_internet_asian,
incentive_sport_tickets = incentive_sport_tickets + incentive_sport_tickets_asian,
outsideGood = outsideGood + outsideGood_asian
) %>% select(value,penalty,accessibility_1,accessibility_3,accessibility_10,incentive_grocery_store,incentive_internet,incentive_sport_tickets,outsideGood)
scenarios
sim_asian <- maddTools::logitProbs(
coefs = coef_draws_asian,
newdata = scenarios,
obsID = 'obsID',
ci = 0.95
)
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
head(scenarios)
head(model)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
head(scenarios)
head(model)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
head(scenarios)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
View(sim_multi)
view(scenarios)
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
view(scenarios)
# Read in market scenarios
scenarios <- read_csv(here('data', 'scenarios.csv'))
view(scenarios)
head(model)
sim_multi <- predict(
model,
newdata = scenarios,
altID = 'altID',
obsID = 'obsID',
ci = 0.95,
returnData = TRUE)
View(sim_multi)
# Save simulations
save(
sim_multi,
file = here("data", "simulation.RData")
)
allsims <- sim_multi %>%
ggplot(aes(
x = as.factor(altID), y = predicted_prob,
ymin = predicted_prob_lower, ymax = predicted_prob_upper)) +
geom_col(fill = "grey", width = 0.6) +
geom_errorbar(width = 0.3) +
facet_wrap(~obsID) +
scale_y_continuous(limits = c(0, 1), labels = scales::percent) +
labs(x = 'Take the vaccine (1=yes,2=no)?', y = 'Probability') +
theme_bw()
allsims
ggsave(
filename = here('data', 'sim_multi.png'),
width = 8, height = 7
)
sim1 <- sim_multi %>%
filter(obsID == 1) %>%
ggplot(aes(
x = as.factor(altID), y = predicted_prob,
ymin = predicted_prob_lower, ymax = predicted_prob_upper)) +
geom_col(fill = "grey", width = 0.6) +
geom_errorbar(width = 0.3) +
facet_wrap(~obsID) +
scale_y_continuous(limits = c(0, 1), labels = scales::percent) +
labs(x = 'Alternative', y = 'Market Share') +
theme_bw()
