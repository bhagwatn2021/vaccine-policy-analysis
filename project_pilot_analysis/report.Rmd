---
title: "Pilot Analysis"
subtitle: "Comparison of different policy options to increase COVID-19 vaccination rates."
author: Jenny Kim, Neel Bhagwat
date: October 27, 2021 
output: 
  html_document:
    toc: true 
    toc_float: true
    number_sections: false
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = "figs/", # Folder where rendered plots are saved
  fig.width = 7.252, # Default plot width
  fig.height = 4, # Default plot height
  fig.retina = 3 # For better plot resolution
)

# Load libraries here
library(tidyverse)
library(here)
```

Write your report content here.

Make sure you update the settings in the YAML for your report. 

Use [markdown](https://commonmark.org/help/) for formatting, e.g.: **Bold**, _Italic_, etc.

Here are some section headers to use: 

# Abstract

This study focuses on the various policies that the US Federal government can enact to increase COVID-19 vaccination rates and stabilize the spread of COVID-19 with herd immunity. It compares a vaccine mandate enforced with a fine, the policy in question, to various incentives such as tax rebates and sporting tickets. It also takes into account the accessibility of vaccination centers, measured by the proximity of vaccination centers from residencies, as well as combinations of these different policy attributes. The target population for this study are all Americans 18 years and older who have not received a dose of a COVID-19 vaccine. Below are lists of all possible values of each attribute included in the choice questions: 

```{r echo=FALSE}
incentive = c("Grocery Store Gift Card", "Internet Rebate", "Sporting Tickets", "Cash")
value = c(0, 50, 100, 200, 300, 500, 1000)
penalty = c(0, 50, 100, 200, 300, 500, 1000)
accessibility = c(0, 1, 3, 10) # Distance (miles) from a vaccination center

```
Accessibility (miles from residency): 
```{r echo=FALSE}
accessibility
```
Incentive (cateogrical): 
```{r echo=FALSE}
incentive
```
Mandate Fine (USD, no mandate for values of $0): 
```{r echo=FALSE}
penalty
```
Incentive Value (USD, no incentive for values of $0): 
```{r echo=FALSE}
value
```

# Introduction

Despite the rollout of COVID-19 vaccines, vaccine hesitancy prevented the United States from achieving herd immunity, the level of immunity that a population has to control the spread of a virus. Below is a chart depicting the number of daily vaccinations over time as a percentage of the population, followed by a chart depicting the percentage of the American population that is vaccinated: 

<center>
  <img src="images/daily-vaccinations.png" width=1500>
</center>

<center>
  <img src="images/total-vaccinations.png" width=1500>
</center>

In turn, the Delta variant, a highly-contagious strain of SARS-COV-2, the virus that causes COVID-19, ravaged through unvaccinated populations and caused a surge in cases. 


### Accessibility

Accessibility refers to the distance which a vaccination clinic would be placed from your home. It varies with 0 (door-door vaccinations) - 10 miles from your residence. 


### Incentives

Incentives refers to the type of commodity that would be given out at tax season for being fully vaccinated against COVID-19 by the tax return deadline. It varies by cash tax rebates and cash equivalents (gift cards) redeemable at:

- Grocery stores
- Internet providers
- Professional sporting events 

### Incentive Value 

Incentive value refers to the value of commodities that would be given out at tax season for  being fully vaccinated against COVID-19 by the tax return deadline. It varies by increasing increments from $0 to $1000. 

### Penalty

Incentive value refers to the penalty due at tax season for failing to get a  being fully vaccinated against COVID-19 by the tax return deadline under a vaccine mandate. It varies by increasing increments from $0 to $1000. 

# Survey Design


# Pilot Data Analysis

### Data Cleaning 

When we first opened the responses from the three separate components, we noticed a lot of null values to numerous attributes, including session ids that seemed to be from unsuccessful attempts to view our survey, or from bots on the internet. To remove these values gracefully, we had to join these three components together by the session id, a unique identifier for each participant associated with the survey. To do so, we took out duplicate columns and removed null values for session. We also computed the time took to complete each survey component in unique columns. Then, we filtered out respondents that did not answer the choice questions and did not meet eligibility criteria. 


## Sample Description

The final pilot survey sample consists of 7 respondents who answered all 10 choice questions and met the eligibility criteria. The choice data sheet contains of 20 rows per respondent, denoting 2 alternatives per question (will you take the vaccine under this condition or not?) and 10 questions each. 

```{r echo=FALSE}
data <- read_csv(here("data", "choiceData.csv"))
data
```
### Demographic Analysis

```{r echo=FALSE}

politics <- data %>% filter(!is.na(politics)) %>% mutate(politics = politics - 4) %>% select(politics) %>% group_by(politics) %>% summarise(num_respondents = n()/20)

politics
```

```{r echo=FALSE}

incomes <- data %>% select(income) %>% filter(!is.na(income)) %>%  group_by(income) %>% summarise(num_respondents = n()/20)
incomes
```

```{r echo=FALSE}

region_label <- c("New England",	"Middle Atlantic",	"South Atlantic", "East South Central",	"East North Central",	"West South Central",	"West North Central",	"Mountain",	"Pacific")
region <- c(1:9)
region_df <- data.frame(region,region_label)
regions <- data %>% select(region) %>% filter(!is.na(region)) %>%  group_by(region) %>% summarise(num_respondents = n()/20) %>% inner_join(region_df,by=c("region"))

regions

```

```{r echo=FALSE}

genders <- data %>% select(gender) %>% filter(!is.na(gender)) %>%  group_by(gender) %>% summarise(num_respondents = n()/20)

genders

```

```{r echo=FALSE}

ages <- data %>% select(yearOfBirth) %>% filter(!is.na(yearOfBirth))  %>% mutate(age = 2021-as.numeric(yearOfBirth)) %>%  group_by(age) %>% summarise(num_respondents = n()/20)
ages[is.na(c("age"))] <- "Prefer not to say"
ages
```
### Modeling

<a href="https://www.codecogs.com/eqnedit.php?latex=Uj&space;=&space;\beta_{1}x^{value}&space;&plus;&space;\beta_{2}x^{penalty}&space;&plus;&space;\beta_{3}x^{accessibility}&space;&plus;&space;\beta_{4}x^{cash}&space;\beta_{5}x^{groceries}&space;\beta_{6}x^{internet}&space;\beta_{7}x^{sport}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Uj&space;=&space;\beta_{1}x^{value}&space;&plus;&space;\beta_{2}x^{penalty}&space;&plus;&space;\beta_{3}x^{accessibility}&space;&plus;&space;\beta_{4}x^{cash}&space;\beta_{5}x^{groceries}&space;\beta_{6}x^{internet}&space;\beta_{7}x^{sport}" title="Uj = \beta_{1}x^{value} + \beta_{2}x^{penalty} + \beta_{3}x^{accessibility} + \beta_{4}x^{cash} \beta_{5}x^{groceries} \beta_{6}x^{internet} \beta_{7}x^{sport}" /></a>

```{r echo=FALSE}
library(janitor)
library(logitr)

# Clean up names of created variables
data <- clean_names(data)

# Estimate the model
model <- logitr(
    data   = data,
    outcome = "choice",
    obsID  = "obs_id",
    pars   = c(
        "value", 
        "penalty",
        "accessibility",
        "incentive_cash",
        "incentive_grocery_store",
        "incentive_internet",
        "incentive_sport_tickets"
    )
)

# View summary of results
summary(model)
coefs <- coef(model)
coefs

# Check the 1st order condition: Is the gradient at the solution zero?
model$gradient

# 2nd order condition: Is the hessian negative definite?
# (If all the eigenvalues are negative, the hessian is negative definite)
eigen(model$hessian)$values
```
# Changes to Final Survey

- We removed unnecessary images that may confuse respondents. 
- We wanted to find out how many people have experienced mistreatment in getting healthcare and see mandates for them, so we added a question asking this. 
- We changed the format of every question to a Yes/No multiple choice button to make the design look more appealing. 
- 

# Appendix



